*github-actions.txt* GitHub Actions integration for Neovim

Author: skanehira
License: MIT

==============================================================================
CONTENTS                                           *github-actions-contents*

1. Introduction .......................... |github-actions-introduction|
2. Requirements .......................... |github-actions-requirements|
3. Installation .......................... |github-actions-installation|
4. Features .............................. |github-actions-features|
5. Configuration ......................... |github-actions-configuration|
6. Commands .............................. |github-actions-commands|
7. Functions ............................. |github-actions-functions|
8. Keymaps ............................... |github-actions-keymaps|
9. Highlights ............................ |github-actions-highlights|

==============================================================================
1. INTRODUCTION                               *github-actions-introduction*

github-actions.nvim is a Neovim plugin that provides GitHub Actions
integration directly within your editor. It allows you to:

- Check GitHub Actions versions automatically
- Dispatch workflows with workflow_dispatch trigger
- View workflow run history with status, duration, and timestamps
- View workflow history filtered by branch/PR
- View job logs with syntax highlighting and folding
- Watch running workflow executions in real-time
- Cancel running or queued workflow executions
- Open workflow/run/job URLs in browser

==============================================================================
2. REQUIREMENTS                               *github-actions-requirements*

- Neovim 0.9+
- GitHub CLI (gh) installed and authenticated
  https://cli.github.com/
- nvim-treesitter with YAML parser
  https://github.com/nvim-treesitter/nvim-treesitter
- telescope.nvim (optional, for enhanced workflow selection)
  https://github.com/nvim-telescope/telescope.nvim

==============================================================================
3. INSTALLATION                               *github-actions-installation*

Using lazy.nvim:
>lua
    {
      'skanehira/github-actions.nvim',
      dependencies = {
        'nvim-treesitter/nvim-treesitter',
        'nvim-telescope/telescope.nvim',  -- Optional
      },
      opts = {},
    }
<

==============================================================================
4. FEATURES                                       *github-actions-features*

4.1 Version Checking~

The plugin automatically activates when you open:
- `.github/workflows/*.yml` or `*.yaml` (workflow files)
- `.github/actions/*/action.yml` or `*.yaml` (composite actions)

Version information is displayed inline at the end of each line using
virtual text:
>
    - uses: actions/checkout@v5      v5.0.0
    - uses: actions/setup-node@v3    v4.0.0
<

4.2 Workflow Dispatch~

Dispatch workflows that have the `workflow_dispatch` trigger configured.
The plugin will:
1. Parse the workflow file for workflow_dispatch configuration
2. Prompt you to select a branch
3. Collect required input parameters
4. Dispatch the workflow using the GitHub CLI

4.3 Workflow Run History~

View the run history for any workflow file. The history view shows:
- Run status (success, failure, cancelled, in_progress, queued)
- Run ID and branch
- Commit message
- Timestamp and duration

You can expand runs to view jobs and steps, and view logs for each job.

4.4 Branch/PR History~

View workflow run history filtered by a specific branch or PR. This allows
you to see all workflow runs for a particular branch without selecting
individual workflow files.

The branch/PR picker:
1. Shows all remote branches with associated PR numbers
2. Format: `branch-name #PR-number` (or just `branch-name` if no PR)
3. Current branch name is pre-filled in the search input for quick selection
4. Select a branch to view all workflow runs triggered on that branch

4.5 Workflow Watch~

Watch running workflow executions in real-time using the GitHub CLI. The
watch feature:
1. Prompts you to select a workflow file
2. Fetches all workflow runs for the selected workflow
3. Filters to show only running workflows (status: in_progress or queued)
4. Displays appropriate action based on the number of running workflows:
   - No running workflows: Shows an info message
   - Single running workflow: Launches gh run watch directly in a new tab
   - Multiple running workflows: Shows a picker to select which run to watch

The watch terminal opens in a new tab with `gh run watch <run-id>` command.
You can exit the terminal with <Ctrl-C> or close the tab when done.

Run Picker Format: [icon] branch-name (#run-id)
- Icon shows the run status (⊙ for in_progress, ○ for queued)
- Branch name indicates which branch triggered the workflow
- Run ID is the GitHub workflow run identifier

4.6 Workflow Selection~

When running commands outside of a workflow file, a picker appears to select
workflow files. The picker behavior depends on whether telescope.nvim is
installed:

With telescope.nvim (enhanced mode):
- Multi-select support: Use <Tab> to select multiple workflows (history only)
- Preview window: Shows the content of the selected workflow file
- Preview scrolling: Use <C-u> and <C-d> to scroll up and down
- Confirm selection: Press <CR> to open selected workflows
- Multiple workflows: Each opens in a separate tab

Without telescope.nvim (fallback mode):
- Uses vim.ui.select for single file selection
- No preview or multi-select support

==============================================================================
5. CONFIGURATION                             *github-actions-configuration*

5.1 Default Configuration~

The plugin works out of the box with sensible defaults. You can customize
it using the setup function:
>lua
    require('github-actions').setup({
      actions = {
        icons = {
          outdated = '',
          latest = '',
          error = '',
        },
        highlight_latest = 'GitHubActionsVersionLatest',
        highlight_outdated = 'GitHubActionsVersionOutdated',
        highlight_error = 'GitHubActionsVersionError',
        highlight_icon_latest = 'GitHubActionsIconLatest',
        highlight_icon_outdated = 'GitHubActionsIconOutdated',
        highlight_icon_error = 'GitHubActionsIconError',
      },
      history = {
        icons = {
          success = '✓',
          failure = '✗',
          cancelled = '⊘',
          skipped = '⊘',
          in_progress = '⊙',
          queued = '○',
          waiting = '○',
          unknown = '?',
        },
        highlights = {
          success = 'GitHubActionsHistorySuccess',
          failure = 'GitHubActionsHistoryFailure',
          cancelled = 'GitHubActionsHistoryCancelled',
          running = 'GitHubActionsHistoryRunning',
          queued = 'GitHubActionsHistoryQueued',
          run_id = 'GitHubActionsHistoryRunId',
          branch = 'GitHubActionsHistoryBranch',
          time = 'GitHubActionsHistoryTime',
          job_name = 'GitHubActionsHistoryJobName',
          step_name = 'GitHubActionsHistoryStepName',
          tree_prefix = 'GitHubActionsHistoryTreePrefix',
        },
        highlight_colors = {
          success = { fg = '#10b981', bold = true },
          failure = { fg = '#ef4444', bold = true },
          cancelled = { fg = '#6b7280', bold = true },
          running = { fg = '#f59e0b', bold = true },
          queued = { fg = '#8b5cf6', bold = true },
        },
        keymaps = {
          list = {
            close = 'q',
            expand = 'l',
            collapse = 'h',
            refresh = 'r',
            rerun = 'R',
            dispatch = 'd',
            watch = 'w',
            cancel = 'C',
            open_browser = '<C-o>',
          },
          logs = {
            close = 'q',
          },
        },
        logs_fold_by_default = true,
      },
    })
<

5.2 Configuration Options~

actions.icons                                   *github-actions-actions-icons*
    Icons for version checking display.

actions.highlight_*                         *github-actions-actions-highlight*
    Highlight groups for version information.

history.icons                                   *github-actions-history-icons*
    Icons for workflow run status.

history.highlights                         *github-actions-history-highlights*
    Highlight groups for workflow history elements.

history.highlight_colors               *github-actions-history-highlight-colors*
    Custom highlight options for workflow history elements.
    Each key accepts a table with highlight options (fg, bg, bold, italic, etc.).

history.keymaps                               *github-actions-history-keymaps*
    Custom keymaps for history buffers. Contains two sub-tables:

    keymaps.list~
        Keymaps for the workflow run list buffer:
        - close: Close the buffer (default: 'q')
        - expand: Expand/collapse run or view logs (default: 'l')
        - collapse: Collapse expanded run (default: 'h')
        - refresh: Refresh history (default: 'r')
        - rerun: Rerun workflow (default: 'R')
        - dispatch: Dispatch workflow (default: 'd')
        - watch: Watch running workflow (default: 'w')
        - cancel: Cancel running workflow (default: 'C')
        - open_browser: Open run/job URL in browser (default: '<C-o>')

    keymaps.logs~
        Keymaps for the logs buffer:
        - close: Close the buffer (default: 'q')

history.logs_fold_by_default       *github-actions-history-logs-fold-by-default*
    Whether to fold log groups by default. Default: true

history.buffer                             *github-actions-history-buffer-config*
    Configure how buffers are opened and displayed.
    Contains two sub-tables:

    buffer.history~
        Configuration for workflow run history buffers:
        - open_mode: How to open the buffer (default: 'tab')
          Valid values: 'tab', 'vsplit', 'split', 'current'
        - buflisted: Whether buffer appears in buffer list (default: true)
        - window_options: Window-local options to set (default: {wrap = true})

    buffer.logs~
        Configuration for logs buffers:
        - open_mode: How to open the buffer (default: 'vsplit')
          Valid values: 'tab', 'vsplit', 'split', 'current'
        - buflisted: Whether buffer appears in buffer list (default: true)
        - window_options: Window-local options to set (default: {wrap = false})

    Example:~
>lua
        require('github-actions').setup({
          history = {
            buffer = {
              history = {
                open_mode = 'split',   -- Open history in horizontal split
                buflisted = true,
                window_options = {
                  wrap = true,
                },
              },
              logs = {
                open_mode = 'vsplit',  -- Open logs in vertical split
                buflisted = true,
                window_options = {
                  wrap = false,
                },
              },
            },
          },
        })
<

==============================================================================
6. COMMANDS                                       *github-actions-commands*

                                                    *:GithubActionsDispatch*
:GithubActionsDispatch
    Dispatch a workflow with workflow_dispatch trigger. If the current buffer
    is a workflow file, dispatch that workflow. Otherwise, show a selector
    to choose a workflow file.

    The command will:
    1. Parse the workflow_dispatch configuration
    2. Prompt for branch selection
    3. Collect required input parameters
    4. Dispatch the workflow using gh CLI

                                                    *:GithubActionsHistory*
:GithubActionsHistory [open_mode]
    Show workflow run history. If the current buffer is a workflow file,
    show its history. Otherwise, show a selector to choose a workflow file.

    Arguments:~
        [open_mode]  Optional. How to open the buffer. Valid values:
                     'tab', 'vsplit', 'split', 'current'
                     Overrides history.buffer.history.open_mode config.

    Example:~
        :GithubActionsHistory split    " Open in horizontal split
        :GithubActionsHistory vsplit   " Open in vertical split

    When using telescope.nvim, you can select multiple workflow files using
    <Tab>. Each selected workflow will open in a separate buffer using the
    specified open_mode.

    The history buffer displays:
    - Recent workflow runs with status
    - Run ID, branch, and commit message
    - Timestamp and duration
    - Expandable jobs and steps (press <CR>)

                                                *:GithubActionsHistoryByPR*
:GithubActionsHistoryByPR [open_mode]
    Show workflow run history filtered by branch or PR.

    Arguments:~
        [open_mode]  Optional. How to open the buffer. Valid values:
                     'tab', 'vsplit', 'split', 'current'
                     Overrides history.buffer.history.open_mode config.

    Example:~
        :GithubActionsHistoryByPR tab    " Open in new tab
        :GithubActionsHistoryByPR split  " Open in horizontal split

    This command opens a branch/PR picker that:
    1. Shows all remote branches with associated PR numbers
    2. Pre-fills the current branch name in the search input
    3. Displays branches in format: `branch-name #PR-number`

    After selecting a branch, all workflow runs for that branch are displayed
    in the history buffer. This is useful for reviewing CI status of a
    specific branch or PR without filtering by workflow file.

                                                    *:GithubActionsWatch*
:GithubActionsWatch
    Watch running workflow executions in real-time. The command will:
    1. Show a picker to select a workflow file
    2. Fetch all workflow runs for the selected workflow
    3. Filter to show only running workflows (in_progress or queued)
    4. Take action based on the number of running workflows:
       - No running workflows: Display info message
       - Single running workflow: Launch gh run watch directly
       - Multiple running workflows: Show picker to select which run to watch
    5. Open terminal in new tab with `gh run watch <run-id>`

    You can use this command from anywhere in Neovim, not just workflow files.

==============================================================================
7. FUNCTIONS                                     *github-actions-functions*

github_actions.setup({opts})                    *github-actions.setup()*
    Setup the plugin with custom configuration.

    Parameters:~
        {opts} (table|nil) Configuration options. See |github-actions-configuration|

github_actions.check_versions()                 *github-actions.check_versions()*
    Check and update version information for the current buffer.
    Automatically called when opening workflow files.

github_actions.dispatch_workflow()              *github-actions.dispatch_workflow()*
    Dispatch a workflow. See |:GithubActionsDispatch|

github_actions.show_history({opts})             *github-actions.show_history()*
    Show workflow run history. See |:GithubActionsHistory|

    Parameters:~
        {opts} (table|nil) Optional configuration:
            - pr_mode (boolean): If true, show branch/PR picker instead of
              workflow file picker. See |:GithubActionsHistoryByPR|

github_actions.watch_workflow()                 *github-actions.watch_workflow()*
    Watch running workflow executions. See |:GithubActionsWatch|

github_actions.open_workflow_url()              *github-actions.open_workflow_url()*
    Open workflow URL(s) in browser. Shows a workflow file picker with
    multi-select support. For each selected workflow file, opens the GitHub
    Actions workflow page in the default browser.

    URL format: https://github.com/{owner}/{repo}/actions/workflows/{file}

github_actions.get_config()                     *github-actions.get_config()*
    Get the current plugin configuration.

    Returns:~
        (table) Current configuration

==============================================================================
8. KEYMAPS                                         *github-actions-keymaps*

8.1 Workflow Picker (Telescope)~
                                            *github-actions-workflow-picker*

When telescope.nvim is installed, the workflow picker provides these keymaps:

    <Tab>       Select/deselect a workflow file for multi-selection
                (only available for :GithubActionsHistory command)

    <CR>        Confirm selection and open workflow(s)

    <C-u>       Scroll preview window up

    <C-d>       Scroll preview window down

    <Esc>       Cancel and close the picker

8.2 Workflow History Buffer~
                                                *github-actions-history-buffer*

The workflow history buffer provides these default keymaps (customizable via
|github-actions-history-keymaps|):

    l           Expand/collapse a workflow run, or view job logs
                - On a run line: expand to show jobs and steps
                - On a job line: open log buffer for that job

    h           Collapse the expanded run

    r           Refresh the workflow run history
                Fetches the latest runs from GitHub API

    R           Rerun the workflow at cursor
                Triggers a rerun of the selected workflow run

    d           Dispatch the current workflow
                Opens workflow dispatch with inputs and branch selection

    w           Watch a running workflow
                - Only available for in_progress or queued runs
                - Opens a terminal running `gh run watch <run-id>`
                - Returns focus to history buffer in normal mode
                - Auto-refreshes history when watch completes

    C           Cancel a running workflow
                - Only available for in_progress or queued runs
                - Auto-refreshes history when cancel completes

    <C-o>       Open run or job URL in browser
                - On a run line: Opens the workflow run page on GitHub
                - On a job line: Opens the specific job page on GitHub
                URL formats:
                - Run: https://github.com/{owner}/{repo}/actions/runs/{run_id}
                - Job: https://github.com/{owner}/{repo}/actions/runs/{run_id}/job/{job_id}

    q           Close the history buffer

8.3 Log Buffer~
                                                    *github-actions-log-buffer*

The log buffer provides these keymaps for navigating logs:

    q           Close the log buffer (customizable via |github-actions-history-keymaps|)

    za          Toggle fold (open/close) - Vim standard keymap

    zo          Open fold - Vim standard keymap

    zc          Close fold - Vim standard keymap

8.4 Example Keymap Configuration~

You can set up custom keymaps for the plugin functions:
>lua
    {
      'skanehira/github-actions.nvim',
      dependencies = {
        'nvim-treesitter/nvim-treesitter',
      },
      keys = {
        {
          '<leader>gd',
          function()
            require('github-actions').dispatch_workflow()
          end,
          desc = 'Dispatch workflow',
        },
        {
          '<leader>gh',
          function()
            require('github-actions').show_history()
          end,
          desc = 'Show workflow history',
        },
        {
          '<leader>gp',
          function()
            require('github-actions').show_history({ pr_mode = true })
          end,
          desc = 'Show workflow history by branch/PR',
        },
        {
          '<leader>gw',
          function()
            require('github-actions').watch_workflow()
          end,
          desc = 'Watch running workflow',
        },
        {
          '<leader>go',
          function()
            require('github-actions').open_workflow_url()
          end,
          desc = 'Open workflow URL in browser',
        },
      },
      opts = {},
    }
<

==============================================================================
9. HIGHLIGHTS                                   *github-actions-highlights*

9.1 Version Checking Highlights~

GitHubActionsVersionLatest                *GitHubActionsVersionLatest*
    Highlight for latest version text

GitHubActionsVersionOutdated              *GitHubActionsVersionOutdated*
    Highlight for outdated version text

GitHubActionsVersionError                 *GitHubActionsVersionError*
    Highlight for error version text

GitHubActionsIconLatest                   *GitHubActionsIconLatest*
    Highlight for latest version icon

GitHubActionsIconOutdated                 *GitHubActionsIconOutdated*
    Highlight for outdated version icon

GitHubActionsIconError                    *GitHubActionsIconError*
    Highlight for error version icon

9.2 History Highlights~

GitHubActionsHistorySuccess               *GitHubActionsHistorySuccess*
    Highlight for successful runs/jobs/steps

GitHubActionsHistoryFailure               *GitHubActionsHistoryFailure*
    Highlight for failed runs/jobs/steps

GitHubActionsHistoryCancelled             *GitHubActionsHistoryCancelled*
    Highlight for cancelled runs/jobs/steps

GitHubActionsHistoryRunning               *GitHubActionsHistoryRunning*
    Highlight for running runs/jobs/steps

GitHubActionsHistoryQueued                *GitHubActionsHistoryQueued*
    Highlight for queued runs/jobs/steps

GitHubActionsHistoryRunId                 *GitHubActionsHistoryRunId*
    Highlight for run ID

GitHubActionsHistoryBranch                *GitHubActionsHistoryBranch*
    Highlight for branch name

GitHubActionsHistoryTime                  *GitHubActionsHistoryTime*
    Highlight for time information

GitHubActionsHistoryJobName               *GitHubActionsHistoryJobName*
    Highlight for job name

GitHubActionsHistoryStepName              *GitHubActionsHistoryStepName*
    Highlight for step name

GitHubActionsHistoryTreePrefix            *GitHubActionsHistoryTreePrefix*
    Highlight for tree prefix (├─, └─)

==============================================================================
vim:tw=78:ts=8:ft=help:norl:
